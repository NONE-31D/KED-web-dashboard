{% extends 'base.html' %}
{% load static %}

{% block content %}

      <style>
        .stock-chart-container {width: 490px; height: 250px; background: #FFFFFF 0% 0% no-repeat padding-box; box-shadow: 10px 10px 10px #00000014; border-radius: 15px;}
        .korea-map-container {margin-top: 30px; width: 588px; height: 855px;  box-shadow: 10px 10px 10px #00000014; border-radius: 15px; background-color: #fff;}
        .right-dashboard {margin-left: 32px; width: 912px; height: 885px;}
        .inspector-chart {margin-left: 30px; width: 490px; height: 250px; box-shadow: 10px 10px 10px #00000014; border-radius: 15px; background-color: #fff;}
        .covid-chart-container {margin-left:30px; width: 490px; height: 250px; box-shadow: 10px 10px 10px #00000014; border-radius: 15px; background-color: #fff;}
        .finan-chart-container {margin-top: 30px; width: 912px; height: 400px; box-shadow: 10px 10px 10px #00000014; border-radius: 15px; background-color: #fff;}
        .employment-chart-container {margin-top: 30px; width: 912px; height: 425px; box-shadow: 10px 10px 10px #00000014; border-radius: 15px; background-color: #fff;}
        .overall-chart {margin-top: 30px; width: 1530px; height: 750px;box-shadow: 10px 10px 10px #00000014; border-radius: 15px; background-color: #fff;}

        .chart-title {width: 100%; height: 60px; border-radius: 15px 15px 0px 0px; background: #DDDDDD 0% 0% no-repeat padding-box; display: flex; align-items: center;}
        .chart-title > span {margin-left: 36px; font-size: 24px; font-weight: 600; letter-spacing: var(--unnamed-character-spacing-0); color: var(--unnamed-color-6c6c6c); text-align: left; color: #6C6C6C;}
      </style>
      <style>
        .stock-term {width: 120px; text-align: center;}
        .stock-keyword {width: 120px; text-align: center;}

        .stock-left-info {margin: 35px 77px 0px 38px; width: 215px;}
        .stock-left-info >div:nth-child(1) {width: 189px; height: 22px;text-align: left; font: normal normal normal 16px/22px Open Sans; letter-spacing: 0px; color: #A5A5A5;}
        .stock-left-info >div:nth-child(2) {margin-top:-10px; width: 189px; height: 69px; text-align: left; font: normal normal bold 50px/68px Open Sans; letter-spacing: 0px; color: #6C6C6C;}
        .stock-left-info >div:nth-child(3) {margin-top:-10px; height: 25px; text-align: left; font: normal normal normal 18px/24px Open Sans; letter-spacing: 0px; color: #FF3C0C; display: flex; align-items: center;}
        .stock-left-info >div:nth-child(3)>div:nth-child(1) {width: 62px;}
        .stock-left-info >div:nth-child(3)>div:nth-child(2) {width: 22px; height: 13px;}
      </style>
      <div class='dashboard-container'>
        <div class='top-container' style="display: flex;">
          <div class='stock-chart-container'>
            <div class="upper-info" style="display: flex;">
              <div class="stock-left-info">
                <div>주식 지수 (폐장 기준)</div>
                <div id='stock-last-data'>2357.32</div>
                <div><div id='stock-change-data' style="width: 62px;">+ 0.60%</div><div><img src="{% static 'img/trending-up.svg' %}" style="vertical-align: top"></div></div>
              </div>
              <script>
                function changeDate(date){
                  keyword = $('.stock-keyword').text();
                  console.log('keyword'+keyword)
                  get_stock_data_by_period(date, keyword);
                  date_text = '';
                  if (date == 30) date_text = '1 Month';
                  else if (date == 180) date_text = '6 Month';
                  else if (date == 365) date_text = '1 Year';
                  
                  $('.stock-term').text(date_text);
                }

                function changeKeyword(keyword){
                  date_text = $('#stock-term').text();
                  date = '';
                  if (date_text == '1 Month') date = 30;
                  else if (date_text == '6 Month') date = 180;
                  else if (date_text == '1 Year') date = 365;
                  
                  console.log(date_text + date)
                  get_stock_data_by_period(date, keyword)
                  $('.stock-keyword').text(keyword)
                }
              </script>
              <div class='dropdown-zone'>
                <div class="dropdown dropdown-filter">
                  <button type="button" class="btn btn-outline-dark stock-term border dropdown-toggle" id="stock-term" data-toggle="dropdown">1 Month</button>
                  <div class="dropdown-menu">
                    <div id='stock-date' class="dropdown-item" onclick="changeDate(30)">1 Month</div>
                    <div id='stock-date' class="dropdown-item" onclick="changeDate(180)">6 Month</div>
                    <div id='stock-date' class="dropdown-item" onclick="changeDate(365)">1 Year</div>
                  </div>
                </div>
                <div class="dropdown dropdown-filter dropdown-lower">
                  <button type="button" class="btn btn-outline-dark stock-keyword border dropdown-toggle" data-toggle="dropdown">KOSPI</button>
                  <div class="dropdown-menu">
                    <div id='stock-keyword' class="dropdown-item" onclick="changeKeyword('KOSPI')">KOSPI</div>
                    <div id='stock-keyword' class="dropdown-item" onclick="changeKeyword('DJI')">DJI</div>
                    <div id='stock-keyword' class="dropdown-item" onclick="changeKeyword('JP225')">JP225</div>
                    <div id='stock-keyword' class="dropdown-item" onclick="changeKeyword('STOXX50')">STOXX50</div>
                    <div id='stock-keyword' class="dropdown-item" onclick="changeKeyword('HSI')">HSI</div>
                    <div id='stock-keyword' class="dropdown-item" onclick="changeKeyword('CSI300')">CSI300</div>
                    <div id='stock-keyword' class="dropdown-item" onclick="changeKeyword('UK100')">UK100</div>
                    <div id='stock-keyword' class="dropdown-item" onclick="changeKeyword('DE30')">DE30</div>
                    <div id='stock-keyword' class="dropdown-item" onclick="changeKeyword('FCHI')">FCHI</div>
                  </div>
                </div>
              </div>
            </div>  
            <div id="chart-revenue-bg" class="chart-sm" style="margin: 39.74px 40px 35px 40px;"></div>
          </div>

          <style>
            .covid-left-info {margin-top: 35px; margin-left: 38px; width: 295px; font-size: 20px; font-weight: 600; color: #6C6C6C;}

            .left-info {margin-top: 35px; margin-left: 38px; width: 335px;}
            .left-info >div:nth-child(1) {width: 189px; height: 22px;text-align: left; font: normal normal normal 16px/22px Open Sans; letter-spacing: 0px; color: #A5A5A5;}
            .left-info >div:nth-child(2) {margin-top:-10px; width: 189px; height: 69px; text-align: left; font: normal normal bold 50px/68px Open Sans; letter-spacing: 0px; color: #6C6C6C;}
            .left-info >div:nth-child(3) {margin-top:-10px; height: 25px; text-align: left; font: normal normal normal 18px/24px Open Sans; letter-spacing: 0px; color: #FF3C0C; display: flex;}
            .left-info >div:nth-child(3)>div:nth-child(1) {max-width: 62px;}
            .left-info >div:nth-child(3)>div:nth-child(2) {margin-left: 10px; width: 22px; height: 13px;}
            
            .dropdown-filter {margin-top: 35px;}
            .dropdown-lower {margin-top: 0px;}
            .dropdown-filter .dropdown-menu {min-width: 120px;}
            .dropdown-filter .dropdown-item {min-width: 120px; text-align: center;}
            .inspector-date {width: 120px; text-align: center;}
            .stock-term {width: 120px; text-align: center;}
            .stock-keyword {width: 120px; text-align: center;}

            .covid-info {margin-left: 293px; width: 108px; height: 49px;}
            .covid-info > div {display: flex; align-self: center;}
            .covid-info > div > div:nth-child(1) {margin-top : 5px; width: 12px; height: 12px; border-radius: 15px; background: #CFE230 0% 0% no-repeat padding-box; opacity: 1;}
            .covid-info > div:nth-child(2) > div:nth-child(1) {background: #35BBCA 0% 0% no-repeat padding-box;}
            .covid-info > div > div:nth-child(2) {margin-left: 10px; width: 86px; height: 22px; text-align: left; font: normal normal normal 16px/22px Open Sans; letter-spacing: 0px; color: #6C6C6C;}

            .inspector-info {width: 108px; height: 49px; margin-top: 57px;}
            .inspector-info > div {display: flex; align-self: center;}
            .inspector-info > div > div:nth-child(1) {margin-top : 5px; width: 12px; height: 12px; border-radius: 15px; background: #CFE230 0% 0% no-repeat padding-box; opacity: 1;}
            .inspector-info > div:nth-child(2) > div:nth-child(1) {background: #35BBCA 0% 0% no-repeat padding-box;}
            .inspector-info > div > div:nth-child(2) {margin-left: 10px; width: 86px; height: 22px; text-align: left; font: normal normal normal 16px/22px Open Sans; letter-spacing: 0px; color: #6C6C6C;}

            .covid-bar {margin: 15px 40px 0px 40px; width: 361px;}
            .covid-bar > div:nth-child(1) {background-color: #CFE230;}
            .covid-bar > div:nth-child(2) {background-color: #35BBCA;}

            .inspector-bar {margin: 65px 40px 0px 40px; width: 410px;}
            .inspector-bar > div:nth-child(1) {background-color: #CFE230;}
            .inspector-bar > div:nth-child(2) {background-color: #35BBCA;}

          </style>

          <div class='inspector-chart'>
            <div class="upper-info" style="display: flex;">
              <div class="left-info">
                <div>일일 확진자</div>
                <div id='covid-last-data'>118명</div>
                <div><div id='covid-change-data'>+ 45명</div><div><img class="covid-trend-img" src="{% static 'img/trending-down.svg' %}" style="vertical-align: center"></div></div>
              </div>
              <div class='inspector-info'>
                <div><div></div><div>확진자</div></div>
                <div><div></div><div>사망자</div></div>
              </div>
            </div>  
            
            <div class="progress progress-sm inspector-bar" style="height: 20px;">
              <div class="progress-bar" id="internal-bar" style="width: 75%; height: 20px;" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100">
                <span class="visually-hidden">75% Complete</span>
              </div>
              <div class="progress-bar" id="external-bar" style="width: 25%; height: 20px;" role="progressbar" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
                <span class="visually-hidden">75% Complete</span>
              </div>
            </div>
          </div>

          <div class='covid-chart-container'>
            <div class="upper-info" style="display: flex; align-items: center;">
              <div class="covid-left-info">
                <div>코로나19 확진자 현황</div>
              </div>
              <script>
                function covid_changePeriod(period){
                  date_text = '';
                  if (period == 30) date_text = '1 Month';
                  else if (period == 90) date_text = '3 Month';
                  else if (period == 180) date_text = '6 Month';
                  
                  get_covid_data_by_period(period)
                  $('.covid-period').text(date_text)
                }
              </script>
              <div class="dropdown dropdown-filter">
                <button type="button" class="btn btn-outline-dark covid-period border dropdown-toggle" data-toggle="dropdown">1 Month</button>
                <div class="dropdown-menu">
                  <div class="dropdown-item" onclick="covid_changePeriod(30)">1 Month</div>
                  <div class="dropdown-item" onclick="covid_changePeriod(90)">3 Month</div>
                  <div class="dropdown-item" onclick="covid_changePeriod(180)">6 Month</div>
                </div>
              </div>
            </div>  
            <div id="covid-chart" class="chart-sm" style="margin: 10px 40px 35px 40px;"></div>
          </div>

        </div>
        <div class='upper-container' style="display: flex;">
          <div class='left-container'>
                        
            <div class='korea-map-container'>
              <div class='chart-title'>
                <span>신설법인현황</span>
              </div>
              <div class="dropdown corperation-dropdown">
                <button type="button" class="btn btn-outline-dark border dropdown-toggle corperation-year" data-toggle="dropdown">2017</button>
                <div class="dropdown-menu corperation-drop">
                  <div class="dropdown-item" onclick="changeCorperationYear(2017)">2017</div>
                  <div class="dropdown-item" onclick="changeCorperationYear(2016)">2016</div>
                  <div class="dropdown-item" onclick="changeCorperationYear(2015)">2015</div>
                  <div class="dropdown-item" onclick="changeCorperationYear(2014)">2014</div>
                  <div class="dropdown-item" onclick="changeCorperationYear(2013)">2013</div>
                </div>
                <button type="button" class="btn btn-outline-dark border dropdown-toggle corperation-sector" data-toggle="dropdown">건설업</button>
                <div class="dropdown-menu corperation-drop">
                  {% for sector in sector_list %}
                    <div class="dropdown-item" onclick="changeCorperationSector('{{sector}}')">{{ sector }}</div>
                  {% endfor %}
                </div>
                <button type="button" class="btn btn-outline-dark border dropdown-toggle corperation-size" data-toggle="dropdown">중기업</button>
                <div class="dropdown-menu corperation-drop">
                  <div class="dropdown-item" onclick="changeCorperationSize('대기업')">대기업</div>
                  <div class="dropdown-item" onclick="changeCorperationSize('중기업')">중기업</div>
                  <div class="dropdown-item" onclick="changeCorperationSize('소기업')">소기업</div>
                </div>
              </div>

              <script>
                function changeCorperationYear(year){
                      sector = $('.corperation-sector').text();
                      size = $('.corperation-size').text();
                      get_corperation_data(year, sector, size);
                      $('.corperation-year').text(year);
                  }
                  function changeCorperationSize(size){
                      year = $('.corperation-year').text();
                      sector = $('.corperation-sector').text();
                      get_corperation_data(year, sector, size);
                      $('.corperation-size').text(size);
                  }
                  function changeCorperationSector(sector){
                      year = $('.corperation-year').text();
                      size = $('.corperation-size').text();
                      get_corperation_data(year, sector, size);
                      $('.corperation-sector').text(sector);
                  }
              </script>
              
              <style>
                .corperation-drop {min-width: 75px;}
                .corperation-drop .dropdown-item {min-width: 75px;}
                .corperation-dropdown {margin:35px 0 0 50px}
                .korea-map-chart {width: 100%; height: 875px; margin-top: 0;}
                .jqvmap-zoomin {display: none;}
                .jqvmap-zoomout {display: none;}
                #map-korea g {transform: scale(0.8, 0.8);}
              </style>
              <div id="map-korea" class="korea-map-chart"></div>
            </div>
          </div>

          <!-- right side of dashboard -->
          
          <div class='right-dashboard'>
            <style>
              .chart-indicator {margin: 30px 0 30px 42px; display: flex; }
              .chart-indicator div {display: flex;}
              .chart-indicator div > div:nth-child(1) {margin-top : 5px; width: 12px; height: 12px; border-radius: 15px; background: #FFDE39  0% 0% no-repeat padding-box; opacity: 1;}
              .chart-indicator > div:nth-child(2) > div:nth-child(1) {background: #CFE230 0% 0% no-repeat padding-box;}
              .chart-indicator div > div:nth-child(2) {margin-left: 10px; width: 75px;}

              .finan-indicator > div:nth-child(2) > div:nth-child(1) {background: #35BBCA 0% 0% no-repeat padding-box;}

              .employment-dropdown {margin: 30px 50px 0 0;}
              .finan-dropdown{margin: 30px 50px 0 0;}
              #employment-chart {margin: 29px 50px 42px 42px; min-width: 772px; min-height: 213px;}
              #finan-chart {margin: 29px 50px 40px 42px; min-width: 772px; min-height: 213px!important; height: 213px;}
              
              .employment-drop-1 {min-width: 75px;}
              .employment-drop-2 {min-width: 79px;}
              .employment-drop-3 {min-width: 89px;}
              .employment-drop-1 .dropdown-item {min-width: 75px;}
              .employment-drop-2 .dropdown-item {min-width: 79px;}
              .employment-drop-3 .dropdown-item {min-width: 89px;}

              .finan-locale-drop {min-width: 75px;}
              .finan-locale-drop .dropdown-item {min-width: 75px;}
            </style>
            <div class='employment-chart-container'>
              <div class='chart-title'>
                <span>종업원현황 - 입·퇴사자 현황</span>
              </div>
              <div class='employment-upper-info' style="display: flex; justify-content: space-between;">
                <div class='chart-indicator'>
                  <div><div></div><div>입사자</div></div>
                  <div><div></div><div>퇴사자</div></div>
                </div>
                
                <script>
                  function changeEmployLocale(locale){
                      year = $('.employ-year').text();
                      size = $('.employ-size').text();
                      get_employment_data(locale, year, size);
                      $('.employ-locale').text(locale);
                  }
                  function changeEmployYear(year){
                      locale = $('.employ-locale').text();
                      size = $('.employ-size').text();
                      get_employment_data(locale, year, size);
                      $('.employ-year').text(year);
                  }
                  function changeEmploySize(size){
                      year = $('.employ-year').text();
                      locale = $('.employ-locale').text();
                      get_employment_data(locale, year, size);
                      $('.employ-size').text(size);
                  }

                    
                </script>
                <div class="dropdown employment-dropdown">
                  <button type="button" class="btn btn-outline-dark border dropdown-toggle employ-locale" data-toggle="dropdown">경기</button>
                  <div class="dropdown-menu employment-drop-1">
                    {% for locale in locale_list %}
                      <div class="dropdown-item" onclick="changeEmployLocale('{{locale}}')">{{ locale }}</div>
                    {% endfor %}
                  </div>

                  <button type="button" class="btn btn-outline-dark border dropdown-toggle employ-year" data-toggle="dropdown">2016</button>
                  <div class="dropdown-menu employment-drop-2">
                    <div class="dropdown-item" onclick="changeEmployYear(2016)">2016</div>
                    <div class="dropdown-item" onclick="changeEmployYear(2017)">2017</div>
                  </div>

                  <button type="button" class="btn btn-outline-dark border dropdown-toggle employ-size" data-toggle="dropdown">중기업</button>
                  <div class="dropdown-menu employment-drop-3">
                    <div class="dropdown-item" onclick="changeEmploySize('대기업')">대기업</div>
                    <div class="dropdown-item" onclick="changeEmploySize('중기업')">중기업</div>
                    <div class="dropdown-item" onclick="changeEmploySize('소기업')">소기업</div>
                  </div>
                </div>
              </div>
              
              <div id="employment-chart" class="chart-lg"></div>
            </div>
            <div class='finan-chart-container'>
              <div class='chart-title'>
                <span>주요재무비율</span>
              </div>
              <div class='finan-upper-info' style="display: flex; justify-content: space-between;">
                <div class='chart-indicator finan-indicator'>
                  <div><div></div><div>중기업</div></div>
                  <div><div></div><div>소기업</div></div>
                </div>
                <div class="dropdown finan-dropdown">
                  <button type="button" class="btn btn-outline-dark border dropdown-toggle finan-column" data-toggle="dropdown">부채비율</button>
                  <div class="dropdown-menu finan-locale-drop">
                    {% for finance in finance_list %}
                      <div class="dropdown-item" onclick="changeFinanColumn('{{finance}}')">{{ finance }}</div>
                    {% endfor %}
                  </div>

                  <button type="button" class="btn btn-outline-dark border dropdown-toggle finan-locale" data-toggle="dropdown">경기</button>
                  <div class="dropdown-menu finan-locale-drop">
                    {% for locale in locale_list %}
                      <div class="dropdown-item" onclick="changeFinanLocale('{{locale}}')">{{ locale }}</div>
                    {% endfor %}
                  </div>

                  <button type="button" class="btn btn-outline-dark border dropdown-toggle finan-sector" data-toggle="dropdown">건설업</button>
                  <div class="dropdown-menu">
                    {% for sector in sector_list %}
                      <div class="dropdown-item" onclick="changeFinanSector('{{sector}}')">{{ sector }}</div>
                    {% endfor %}
                  </div>

                  <script>
                    function changeFinanColumn(column){
                      locale = $('.finan-locale').text();
                      sector = $('.finan-sector').text();
                      get_finance_data(column, locale, sector);
                      $('.finan-column').text(column);
                    }
                    function changeFinanLocale(locale){
                      sector = $('.finan-sector').text();
                      column = $('.finan-column').text();
                      get_finance_data(column, locale, sector);
                      $('.finan-locale').text(locale);
                    }
                    function changeFinanSector(sector){
                      column = $('.finan-column').text();
                      locale = $('.finan-locale').text();
                      get_finance_data(column, locale, sector);
                      $('.finan-sector').text(sector);
                    }
                  </script>
                </div>
              </div>
              <div id="finan-chart"></div>
            </div>
          </div>
        </div>  

        <style>
          .chart-filters { display: flex;}
          .chart-filters button {min-width: 140px; height: 40px; margin-right: 20px;}
          .chart-filters button:last-child {margin-left: 20px; margin-right: 0; width: 100px;}

          .chart-filters .dropdown-menu {min-width: 140px;}
          .chart-filters .dropdown-item {min-width: 140px; text-align: center;}

          .overall-container {margin: 29px 50px 40px 50px; height: 530px; display: flex; align-items: center;}
          .overall-container > div {width: 700px;}
          .overall-container > div:first-child {margin-right: 30px;}

          .overall-upper-info {margin: 40px 55px 40px 55px; display: flex; align-items: center; justify-content: space-between;}
          .overall-filter-info {font-size: 20px; font-weight: 600; color: #6C6C6C;}

          .overall-chart-name {font-size: 20px; font-weight: 600; color: #6C6C6C; text-align: center;}
          .overall-chart-detail {margin-bottom: 10px;}
        </style>
        <div class='overall-chart'>
          <div class='chart-title'>
            <span>종합 재무지표</span>
          </div>

          <script>
            function changeOverallYear(year){
                sector = $('.overall-sector').text();
                size = $('.overall-size').text();
                locale = $('.overall-locale').text();
                get_prealert_data(year,locale, size, sector);
                get_liability_and_roe_data(year,locale, size);
                $('.overall-year').text(year);
            }
            function changeOverallLocale(locale){
                sector = $('.overall-sector').text();
                size = $('.overall-size').text();
                year = $('.overall-year').text();
                get_prealert_data(year,locale, size, sector);
                get_liability_and_roe_data(year,locale, size);
                $('.overall-locale').text(locale);
            }
            function changeOverallSize(size){
                sector = $('.overall-sector').text();
                year = $('.overall-year').text();
                locale = $('.overall-locale').text();
                get_prealert_data(year,locale, size, sector);
                get_liability_and_roe_data(year,locale, size);
                $('.overall-size').text(size);
            }
            function changeOverallSector(sector){
                year = $('.overall-year').text();
                size = $('.overall-size').text();
                locale = $('.overall-locale').text();
                get_prealert_data(year,locale, size, sector);
                $('.overall-sector').text(sector);
            }
          </script>

          <div class='overall-upper-info'>
            <div class="overall-filter-info"></div>
            <div class="chart-filters dropdown">
              <button type="button" class="btn btn-outline-dark border dropdown-toggle overall-year" id="dropdownMenu1" data-toggle="dropdown">2017</button>
              <div class="dropdown-menu" aria-labelledby="dropdownMenu1">
                <div class="dropdown-item" onclick="changeOverallYear(2015)">2015</div>
                <div class="dropdown-item" onclick="changeOverallYear(2016)">2016</div>
                <div class="dropdown-item" onclick="changeOverallYear(2017)">2017</div>
              </div>
              <button type="button" class="btn btn-outline-dark border dropdown-toggle overall-locale" id="dropdownMenu2" data-toggle="dropdown">경기</button>
              <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
                {% for locale in locale_list %}
                  <div class="dropdown-item" onclick="changeOverallLocale('{{locale}}')">{{ locale }}</div>
                {% endfor %}
              </div>
              <button type="button" class="btn btn-outline-dark border dropdown-toggle overall-size" id="dropdownMenu4" data-toggle="dropdown">중기업</button>
              <div class="dropdown-menu" aria-labelledby="dropdownMenu4">
                <div class="dropdown-item" onclick="changeOverallSize('대기업')">대기업</div>
                <div class="dropdown-item" onclick="changeOverallSize('중기업')">중기업</div>
                <div class="dropdown-item" onclick="changeOverallSize('소기업')">소기업</div>
              </div>
              <button type="button" class="btn btn-outline-dark border dropdown-toggle overall-sector" id="dropdownMenu4" data-toggle="dropdown">건설업</button>
              <div class="dropdown-menu" aria-labelledby="dropdownMenu4">
                {% for sector in sector_list %}
                  <div class="dropdown-item" onclick="changeOverallSector('{{sector}}')">{{ sector }}</div>
                {% endfor %}
              </div>
              <button type="button" class="btn btn-info">OK</button>
            </div>
          </div>
          <div class="upper-container overall-container">
            <div>
              <div class='overall-chart-name'>조기경보등급</div>
              <div id="pre-alert-chart"></div>
            </div>
            
            <div id="overall-right-container">
              <div class='overall-chart-name'>부채비율 - ROE</div>
              <div class="overall-chart-detail" id="overall-roe-chart"></div>
            </div>
          </div>


        </div>
    <script>
      function corperation_chart_refresh(result_data){
        $('#map-korea').vectorMap({
      		map: 'kor_en',
      		backgroundColor: 'transparent',
      		color: 'rgba(120, 130, 140, .1)',
      		borderColor: 'transparent',
      		scaleColors: ["#35BBCA", "#CFE230"],
      		normalizeFunction: 'polynomial',
      		values: (chart_data = result_data),
      		onLabelShow: function (event, label, code) {
      			if (chart_data[code] > 0) {
      				label.append(': <strong>' + chart_data[code] + '</strong>');
      			}
      		},
      	});
      }
      function get_corperation_data(year, sector, size){
        $.ajax({
          url: "./get_corperation_data/",
          type: "get",
          dataType: "json",
          contentType: "application/json",
          data: {"sector":sector, "year":year, "size":size},
          success: function(resultData) {        
            $('#map-korea > svg').css('display', 'none')
            old_chart_id = $('#map-korea > svg').attr('id')
            $('#map-korea > .jqvmap-zoomin').remove()
            $('#map-korea > .jqvmap-zoomout').remove()
            $('#map-korea > svg').remove()

            corperation_chart_refresh(resultData)
          },
          error: function(jqXHR, textStatus, errorThrown) {
              // 에러 로그는 아래처럼 확인해볼 수 있다. 
              console.log("employ data loading 에러\ncode : " + jqXHR.status + "\nerror message : " + jqXHR.responseText);
          }
      });
      }
      // @formatter:on
      document.addEventListener("DOMContentLoaded", get_corperation_data(2017, "건설업", "중기업"));
      // @formatter:off
    </script>

<script>
  function get_stock_data_by_period(date, keyword){
    $.ajax({
        url: "./get_stock_data/",
        type: "get",
        dataType: "json",
        contentType: "application/json",
        data: {'date': date, 'keyword': keyword},
        success: function(resultData) {
          $('#chart-revenue-bg > div').css('display', 'none')
          old_chart_id = $('#chart-revenue-bg > div').attr('id')
          let element = document.getElementById(old_chart_id);
          if (element != null){
            element.outerHTML = '';
            delete element;
          }
                    
          stock_chart_refresh(resultData['stock_data'], resultData['date'])
          $('#stock-last-data').text(resultData['last_data'])
          changeRatio = ""
          if (resultData['change'] > 0) changeRatio = '+'
          else if (resultData['change'] = 0) changeRatio = ''
          else if (resultData['change'] < 0) changeRatio = '-'
          $('#stock-change-data').text(changeRatio + ' ' + resultData['change'] + '%')
        },
        error: function(jqXHR, textStatus, errorThrown) {
            // 에러 로그는 아래처럼 확인해볼 수 있다. 
            console.log("stock data loading 에러\ncode : " + jqXHR.status + "\nerror message : " + jqXHR.responseText);
        }
    }); 
  }

  function stock_chart_refresh(stock_data, stock_date){
    window.ApexCharts && (new ApexCharts(document.getElementById('chart-revenue-bg'), {
      chart: {
        type: "area",
        fontFamily: 'inherit',
        height: 40.0,
        sparkline: {
          enabled: true
        },
        animations: {
          enabled: false
        },
      },
      dataLabels: {
        enabled: false,
      },
      fill: {
        opacity: .32,
        type: 'solid'
      },
      stroke: {
        width: 2,
        lineCap: "round",
        curve: "smooth",
      },
      series: [{
        name: "Close",
        data: stock_data
      }],
      grid: {
        strokeDashArray: 4,
      },
      xaxis: {
        labels: {
          padding: 0
        },
        tooltip: {
          enabled: false
        },
        axisBorder: {
          show: false,
        },
        type: 'datetime',
      },
      yaxis: {
        labels: {
          padding: 4
        },
      },
      labels: stock_date,
      colors: ["#feb340"],
      legend: {
        show: false,
      },
    })).render();
  }

  document.addEventListener("DOMContentLoaded", get_stock_data_by_period(30, 'KOSPI'));
  // @formatter:on
</script>

<script>
  // @formatter:off
  function get_covid_data_by_period(period){
    $.ajax({
        url: "./get_covid_data/",
        type: "get",
        dataType: "json",
        contentType: "application/json",
        data: {'period': period},
        success: function(resultData) {
          $('#covid-chart > div').css('display', 'none')
          old_chart_id = $('#covid-chart > div').attr('id')
          let element = document.getElementById(old_chart_id);
          if (element != null){
            element.outerHTML = '';
            delete element;
          }
                    
          covid_chart_refresh(resultData)
          $('#covid-last-data').text(resultData['today_natDefCnt']+"명")
          changeRatio = ""
          if (resultData['change_value'] > 0) {
            changeRatio = '+'
            $('.covid-trend-img').attr("src", "{% static 'img/trending-up.svg' %}");
          }
          else if (resultData['change_value'] = 0) {
            changeRatio = ''
          }
          else if (resultData['change_value'] < 0) {
            changeRatio = '-'
            $('#.covid-trend-img').attr("src", "{% static 'img/trending-down.svg' %}");
          }
          $('#covid-change-data').text(changeRatio + ' ' + resultData['change_value'] + ' 명')
          changeCovidProgressbar(resultData['today_natDefCnt'], resultData['today_natDeathCnt'])
        },
        error: function(jqXHR, textStatus, errorThrown) {
            // 에러 로그는 아래처럼 확인해볼 수 있다. 
            console.log("covid data loading 에러\ncode : " + jqXHR.status + "\nerror message : " + jqXHR.responseText);
        }
    }); 
  }
  function changeCovidProgressbar(def, death) {
                var internal = def;
                var external = death;
                var total = internal+external;

                var intern_percent = (internal/total)*100;
                var extern_percent = (external/total)*100;

                var intern_elem = document.getElementById("internal-bar");
                var extern_elem = document.getElementById("external-bar");

                intern_elem.style.width = intern_percent + "%";
                extern_elem.style.width = extern_percent + "%";
              }
  function covid_chart_refresh(result_data){
    window.ApexCharts && (new ApexCharts(document.getElementById('covid-chart'), {
      chart: {
        type: "line",
        fontFamily: 'inherit',
        height: 140,
        parentHeightOffset: 0,
        toolbar: {
          show: false,
        },
        animations: {
          enabled: false
        },
      },
      fill: {
        opacity: 1,
      },
      stroke: {
        width: 2,
        lineCap: "round",
        curve: "straight",
      },
      series: [{
        name: "확진자",
        data: result_data['natDefCnt']
      },{
        name: "사망자",
        data: result_data['natDeathCnt']
      }],
      grid: {
        padding: {
          top: -20,
          right: 0,
          left: -4,
          bottom: -4
        },
        strokeDashArray: 4,
      },
      xaxis: {
        labels: {
          padding: 0
        },
        tooltip: {
          enabled: false
        },
        axisBorder: {
          show: false,
        },
        type: 'datetime',
      },
      yaxis: {
        labels: {
          padding: 4
        },
      },
      labels: result_data['createDt'],
      colors: ["#CFE230", "#35BBCA"],
      legend: {
        show: true,
      			position: 'top',
      			height: 22,
      			offsetX: 240,
      			offsetY: 8,
      			markers: {
      				width: 8,
      				height: 8,
      				radius: 100,
      			},
      			itemMargin: {
      				horizontal: 8,
      			},
      },
    })).render();
  }
  document.addEventListener("DOMContentLoaded", get_covid_data_by_period(30));
  // @formatter:on
</script>
<script>
  // @formatter:off
  function employ_chart_refresh(result_data){
    window.ApexCharts && (new ApexCharts(document.getElementById('employment-chart'), {
      chart: {
        type: "bar",
        fontFamily: 'inherit',
        height: 260,
        parentHeightOffset: 0,
        toolbar: {
          show: false,
        },
        animations: {
          enabled: false
        },
      },
      plotOptions: {
        bar: {
          columnWidth: '50%',
        }
      },
      dataLabels: {
        enabled: false,
      },
      fill: {
        opacity: 1,
      },
      series: [{
        name: "",
        data: result_data['new']
      },{
        name: "",
        data: result_data['retiree']
      }],
      grid: {
        padding: {
          top: -20,
          right: 0,
          left: -4,
          bottom: -4
        },
        strokeDashArray: 4,
      },
      xaxis: {
        labels: {
          padding: 0
        },
        tooltip: {
          enabled: false
        },
        axisBorder: {
          show: false,
        },
      },
      yaxis: {
        labels: {
          padding: 4
        },
      },
      labels: result_data['label'],
      colors: ["#FFDE39", "#CFE230"],
      legend: {
        show: false,
      },
    })).render();
  }

  function get_employment_data(locale, year, size){
    $.ajax({
        url: "./get_employment_data/",
        type: "get",
        dataType: "json",
        contentType: "application/json",
        data: {"locale":locale, "year":year, "size":size},
        success: function(resultData) {    
          $('#employment-chart > div').css('display', 'none')
          old_chart_id = $('#employment-chart > div').attr('id')
          let element = document.getElementById(old_chart_id);
          if (element != null){
            element.outerHTML = '';
            delete element;
          }                
          employ_chart_refresh(resultData)
        },
        error: function(jqXHR, textStatus, errorThrown) {
            // 에러 로그는 아래처럼 확인해볼 수 있다. 
            console.log("employ data loading 에러\ncode : " + jqXHR.status + "\nerror message : " + jqXHR.responseText);
        }
    });
  }

  document.addEventListener("DOMContentLoaded", get_employment_data("경기", 2017, "대기업"));
  // @formatter:on
</script>
<script>
  // @formatter:off
  function finan_chart_refresh(result_data){
    window.ApexCharts && (new ApexCharts(document.getElementById('finan-chart'), {
      chart: {
        type: "area",
        fontFamily: 'inherit',
        height: 210,
        parentHeightOffset: 0,
        toolbar: {
          show: false,
        },
        animations: {
          enabled: false
        },
      },
      dataLabels: {
        enabled: false,
      },
      fill: {
        opacity: 0,
        type: 'solid'
      },
      stroke: {
        width: 2,
        lineCap: "round",
        curve: "smooth",
      },
      series: [{
        name: "중기업",
        data: result_data['small']
      },{
        name: "소기업",
        data: result_data['mid']
      }],
      grid: {
        padding: {
          top: -20,
          right: 0,
          left: -4,
          bottom: -4
        },
        strokeDashArray: 4,
      },
      xaxis: {
        labels: {
          padding: 0
        },
        tooltip: {
          enabled: false
        },
        axisBorder: {
          show: false,
        },
        categories: result_data['label'],
      },
      yaxis: {
        labels: {
          padding: 4
        },
      },
      colors: ["#FFDE39", "#35BBCA"],
      legend: {
        show: false,
      },
    })).render();
  }
  function get_finance_data(column, locale, sector){
    $.ajax({
      url: "./get_finance_data/",
        type: "get",
        dataType: "json",
        contentType: "application/json",
        data: {"column":column, "locale": locale, "sector":sector},
        success: function(resultData) {    
          $('#finan-chart > div').css('display', 'none')
          old_chart_id = $('#finan-chart > div').attr('id')
          let element = document.getElementById(old_chart_id);
          if (element != null){
            element.outerHTML = '';
            delete element;
          }                
          finan_chart_refresh(resultData)
        },
        error: function(jqXHR, textStatus, errorThrown) {
            // 에러 로그는 아래처럼 확인해볼 수 있다. 
            console.log("finance data loading 에러\ncode : " + jqXHR.status + "\nerror message : " + jqXHR.responseText);
        }
    }); 
  }
  document.addEventListener("DOMContentLoaded", get_finance_data("부채비율", "경기", "건설업"));
  // @formatter:on
</script>

<script>
  // @formatter:off
  function prealert_chart_refresh(result_data){
    window.ApexCharts && (new ApexCharts(document.getElementById('pre-alert-chart'), {
      chart: {
        type: "donut",
        fontFamily: 'inherit',
        height: 400,
        sparkline: {
          enabled: true
        },
        animations: {
          enabled: false
        },
      },
      fill: {
        opacity: 1,
      },
      series: result_data['data'],
      labels: result_data['label'],
      grid: {
        strokeDashArray: 4,
      },
      // colors: ["#FEB340", "#FFDE39", "#CFE230", "#CFE230", "#CFE230", "#CFE230", "#35BBCA", "#0191B4", "#0191B4"],
      colors: ["#0191B4", "#35BBCA", "#CFE230", "#CFE230", "#CFE230", "#CFE230", "#FFDE39", "#FEB340", "#FEB340"],
      legend: {
        show: false,
      },
      tooltip: {
        fillSeriesColor: false
      },
    })).render();
  }
  function get_prealert_data(year, locale, size, sector){
    $.ajax({
        url: "./get_prealert_data/",
        type: "get",
        dataType: "json",
        contentType: "application/json",
        data: {"year":year, "locale":locale, "size":size, "sector":sector},
        success: function(resultData) {          
          $('#pre-alert-chart > div').remove()
          prealert_chart_refresh(resultData)
        },
        error: function(jqXHR, textStatus, errorThrown) {
            // 에러 로그는 아래처럼 확인해볼 수 있다. 
            console.log("employ data loading 에러\ncode : " + jqXHR.status + "\nerror message : " + jqXHR.responseText);
        }
    });
  }
  document.addEventListener("DOMContentLoaded", get_prealert_data(2017, "경기", "중기업", "건설업"));
  // @formatter:on
</script>

<script>
  function get_liability_and_roe_data(year, locale, size){
    $.ajax({
        url: "./get_roe_liability_data/",
        type: "get",
        // dataType: "json",
        contentType: "application/json",
        data: {"locale":locale, "year":year, "size":size},
        success: function(resultData) {    
          $('#overall-roe-chart > div').remove()     
          roe_chart_refresh(resultData)
        },
        error: function(jqXHR, textStatus, errorThrown) {
            // 에러 로그는 아래처럼 확인해볼 수 있다. 
            console.log("roe data loading 에러\ncode : " + jqXHR.status + "\nerror message : " + jqXHR.responseText);
        }
    });
  }

  function roe_chart_refresh(result_data){
    console.log(result_data)
    var options = {
      chart: {
        height: 400,
        type: "heatmap",
        toolbar: {
          show: false,
        },
      },
      dataLabels: {
        enabled: false
      },
      plotOptions: {
        heatmap: {
          enableShades: true,
          colorScale: {
            ranges: [{
              from: -1,
              to: -1,
              name: "None",
              color: "#ffffff"
            },{
              from: 0,
              to: 0,
              name: "{{sector_list.0}}",
              color: "#86D6DF"
            },{
              from: 1,
              to: 1,
              name: "{{sector_list.1}}",
              color: "#5DC9D5"
            },{
              from: 2,
              to: 2,
              name: "{{sector_list.2}}",
              color: "#35BBCA"
            },{
              from: 3,
              to: 3,
              name: "{{sector_list.3}}",
              color: "#288C98"
            },{
              from: 4,
              to: 4,
              name: "{{sector_list.4}}",
              color: "#67BDD2"
            },{
              from: 5,
              to: 5,
              name: "{{sector_list.5}}",
              color: "#34A7C3"
            },{
              from: 6,
              to: 6,
              name: "{{sector_list.6}}",
              color: "#0191B4"
            },{
              from: 7,
              to: 7,
              name: "{{sector_list.7}}",
              color: "#016D87"
            },{
              from: 8,
              to: 8,
              name: "{{sector_list.8}}",
              color: "#B8C82A"
            },{
              from: 9,
              to: 9,
              name: "{{sector_list.9}}",
              color: "#E2EE83"
            },{
              from: 10,
              to: 10,
              name: "{{sector_list.10}}",
              color: "#D9E859"
            },{
              from: 11,
              to: 11,
              name: "{{sector_list.11}}",
              color: "#CFE230"
            },{
              from: 12,
              to: 12,
              name: "{{sector_list.12}}",
              color: "#FED494"
            },{
              from: 13,
              to: 13,
              name: "{{sector_list.13}}",
              color: "#FEC36A"
            },{
              from: 14,
              to: 14,
              name: "{{sector_list.14}}",
              color: "#FEB340"
            },{
              from: 15,
              to: 15,
              name: "{{sector_list.15}}",
              color: "#E2C532"
            },{
              from: 16,
              to: 16,
              name: "{{sector_list.16}}",
              color: "#FFEF8D"
            },{
              from: 17,
              to: 17,
              name: "{{sector_list.17}}",
              color: "#FFE855"
            },{
              from: 18,
              to: 18,
              name: "{{sector_list.18}}",
              color: "#FFDE39"
            },]
          }
        }
      },
      series: result_data['data'],
      xaxis: {
        type: "category",
        categories: result_data['label']
      }
    };
    window.ApexCharts && (new ApexCharts(document.getElementById("overall-roe-chart"),options)).render();
  }
  
  document.addEventListener("DOMContentLoaded", get_liability_and_roe_data(2017, "경기", "중기업"));
</script>

{% endblock %}